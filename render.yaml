services:
  # Backend (Web Service) - 保持不变
  - type: web
    name: home-assistant-backend
    runtime: python
    buildCommand: pip install -r requirements.txt
    startCommand: uvicorn main:app --host 0.0.0.0 --port $PORT
    rootDir: backend
    envVars:
      - key: PYTHON_VERSION
        value: 3.10.0

  # Frontend (Static Site) - 改成这样
  - type: web
    name: home-assistant-frontend
    runtime: static               # ← 关键在这里
    buildCommand: npm install && npm run build
    rootDir: frontend
    staticPublishPath: dist       # ← 必须加这个字段，告诉 Render 要发布哪个文件夹
    # routes 字段在 runtime: static 时是支持的
    routes:
      - type: rewrite
        source: /api/*
        destination: https://home-assistant-backend.onrender.com/api/*
      - type: rewrite
        source: /*
        destination: /index.html